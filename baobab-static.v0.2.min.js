String.prototype.format||(String.prototype.format=function(){var a=Array.prototype.slice.call(arguments);return this.replace(/{(\d+)}/g,function(b,c){return"undefined"==typeof a[c]?b:a[c]})});const viewBox={left:-50,top:-50,width:100,height:100};viewBox.radius=Math.min(viewBox.width,viewBox.height)/2,viewBox.right=viewBox.left+viewBox.width,viewBox.bottom=viewBox.top+viewBox.height,document.getElementById("baobab").setAttribute("viewBox","{0} {1} {2} {3}".format(viewBox.left,viewBox.top,viewBox.width,viewBox.height));const baobab={strokeWidth:viewBox.radius/750,globalFontSizeMax:viewBox.radius/10,globalFontSizeMin:viewBox.radius/50};function concatPath(a){for(var b=a.data.n,c=a.parent;c;c=c.parent)b=c.data.n+"/"+b;return b}function tooltipFormat(a){return"{0}\n{1} lines modified\n{2} lines today".format(concatPath(a),humanReadable(a.data.m),humanReadable(a.data.t))}function humanReadable(a){var b=Math.round;return 1e6<a?b(a/1e5)/10+"M":1e3<a?b(a/100)/10+"K":a}function toHex(a){const b=Math.round(a).toString(16);return 1==b.length?"0"+b:b}function colorRatioSquareScale(a){var b=Math.sqrt;return 0==a.data.t?1:b(a.data.m)/b(a.data.t)}function colorHotCold(a){const b=Math.min(1,colorRatioSquareScale(a)),c=51;return"#{0}88{1}".format(toHex(c+(255-c)*b),toHex(c+(255-c)*(1-b)))}function makeViewCoords(a,b,c){var d=Math.max,e=Math.min;const f=2*Math.PI;return 0<a&&a<f||0<b&&b<f||0>=a&&f<=b?{x0:d(0,a),x1:e(f,b),y0:c,y1:c+1}:{x0:0,x1:0,y0:0,y1:0}}function makeTree(a){return d3.hierarchy(a).sum(a=>a.children?(a.todayInvisible=a.t-a.children.reduce((a,b)=>a+b.t,0),a.modifiedInvisible=a.m-a.children.reduce((a,b)=>a+b.m,0),a.modifiedInvisible):a.children?a.modifiedInvisible:a.m).sort((c,a)=>a.data.m-c.data.m)}function partition(a){const b=d3.partition().size([2*Math.PI,a.height]);return b(a)}function makeGlobalRoot(a){const b=makeTree(a),c=partition(b);return c.each(a=>a.view=makeViewCoords(a.x0,a.x1,a.depth)),c}const root=makeGlobalRoot(baobab_data);function makeScaleY(a){return d3.scaleLog().domain([1,a.height+1]).range([15,viewBox.radius])}var scale_y=makeScaleY(root);function rad2deg(a){return 90*a/Math.PI}function labelTransform(a){if(1>=a.view.y0+a.view.y1||!a.padding)return``;var b=rad2deg(a.view.x0+a.view.x1),c=scale_y(a.view.y0)+a.padding+a.fontSize/2;return 90<=b&&270>=b?`rotate(${b+180}) translate(0, ${c})`:`rotate(${b}) translate(0, ${-c})`}const arc=d3.arc().startAngle(a=>a.view.x0).endAngle(a=>a.view.x1).innerRadius(a=>scale_y(a.view.y0)).outerRadius(a=>scale_y(a.view.y1)),svg=d3.select("#baobab").style("font","sans-serif");baobab.canvas=svg.append("g"),baobab.arcShapes=baobab.canvas.append("g").selectAll("path").data(root.descendants().slice(1)).join("path").attr("d",a=>arc(a)).style("stroke-width",baobab.strokeWidth),baobab.arcShapes.filter(a=>0<a.view.y1).attr("stroke-opacity",1).attr("fill-opacity",1).attr("fill",a=>colorHotCold(a)),baobab.arcShapes.filter(a=>0==a.view.y1).attr("stroke-opacity",0).attr("fill-opacity",0),baobab.arcShapes.filter(a=>a.children).style("cursor","pointer").on("click",clicked),baobab.arcToolTips=baobab.arcShapes.append("title").text(a=>tooltipFormat(a));function balanceProportions(a,b){for(var c=Math.PI,d=c/2,e=0;d>e+.01;){const c=(e+d)/2;0<Math.sin(c)-a-2*Math.cos(c)/b?d=c:e=c}return e}function fitTextToArc(a,b){var c=Math.atan,d=Math.min;const e=c=>{var d=Math.pow;const e=a.innerRadius+c,f=Math.sqrt(d(c*b/2,2)+d(e,2));return a.outerRadius-f},f=Math.max(baobab.globalFontSizeMin,d(a.height/2,.9*a.innerLength/b,baobab.globalFontSizeMax)),g=e(f),h=c(f*b/(2*a.innerRadius+g));if(0<g&&h<a.centralAngle/2)return[f,g/2];const i=.1*a.height,j=(a.innerRadius+i)/(a.outerRadius-i),k=balanceProportions(j,b),l=a.outerRadius*(Math.sin(k)-j);if(l>baobab.globalFontSizeMin&&k<a.centralAngle/2){const a=e(l),b=d(l,baobab.globalFontSizeMax);if(0<a)return[b,a/2]}if(f>baobab.globalFontSizeMin){const d=e(baobab.globalFontSizeMin),f=c(baobab.globalFontSizeMin*b/(2*a.innerRadius+d));if(0<d&&f<a.centralAngle/2)return[baobab.globalFontSizeMin,d/2]}return[.001,0]}function makeArcSpec(a){const b={};return b.innerRadius=scale_y(a.y0),b.outerRadius=scale_y(a.y1),b.centralAngle=a.x1-a.x0,b.innerLength=b.centralAngle*b.innerRadius,b.height=b.outerRadius-b.innerRadius,b}function labelFontSizeArc(a){return[a.fontSize,a.padding]=fitTextToArc(makeArcSpec(a.view),a.textRatio),.001>=a.fontSize&&void 0,a.fontSize+"px"}function labelVisible(a){if(0==a.view.y1)return!1;const b=makeArcSpec(a.view);return!(baobab.globalFontSizeMin>b.height/2||baobab.globalFontSizeMin*a.textRatio>b.outerRadius)}function labelFontSizeRoot(a,b){var c=Math.min;const d=(b.fontSize||14)/a.getComputedTextLength(),e=.9*(2*scale_y(1)*d);return b.fontSize=c(e,baobab.globalFontSizeMax),b.fontSize+"px"}baobab.arcLabels=baobab.canvas.append("g").attr("pointer-events","none").style("fill","#333").selectAll("text").data(root.descendants().slice(1)).join("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","sans-serif").text(a=>a.data.n),baobab.arcLabels.each(function(a){a.textRatio=this.getComputedTextLength()/14}),baobab.arcLabels.filter(a=>labelVisible(a)).attr("fill-opacity",1).attr("font-size",a=>labelFontSizeArc(a)).attr("transform",a=>labelTransform(a)).on("click",clicked),baobab.arcLabels.filter(a=>!labelVisible(a)).attr("fill-opacity",0),baobab.rootShape=baobab.canvas.append("circle").datum(root).attr("r",scale_y(1)).attr("fill","#eee").attr("fill-opacity",.6).attr("pointer-events","all").on("click",a=>clicked(a.parent)),baobab.rootToolTip=baobab.rootShape.append("title").text(a=>tooltipFormat(a)),baobab.rootLabel=baobab.canvas.append("text").datum(root).text(a=>concatPath(a)).attr("fill","#333").attr("text-anchor","middle").attr("dy","-1.2px").attr("font-family","sans-serif").style("font-size",function(a){return labelFontSizeRoot(this,a)});function clicked(a){const b=a||root;scale_y=makeScaleY(b),baobab.rootShape.datum(b).style("cursor",b.parent?"pointer":"default"),baobab.rootToolTip.text(a=>tooltipFormat(a)),baobab.rootLabel.text(concatPath(b)).style("font-size",function(a){return labelFontSizeRoot(this,a)}),baobab.rootLabelLinesToday.datum(b).text(a=>a.data.t+" lines today"),baobab.rootLabelLinesModified.datum(b).text(a=>a.data.m+" lines inserted / deleted");const c=2*Math.PI,d=1/(b.x1-b.x0),e=(a,e,f)=>{const g=f-b.depth;if(0<g){const f=(a-b.x0)*d,h=(e-b.x0)*d;if(0<f&&1>f||0<h&&1>h||0>=f&&1<=h)return{x0:Math.max(0,f)*c,x1:Math.min(1,h)*c,y0:g,y1:g+1}}return{x0:0,x1:0,y0:0,y1:0}};root.each(a=>a.view=e(a.x0,a.x1,a.depth)),baobab.arcShapes.attr("d",a=>arc(a)).attr("fill-opacity",a=>0<a.view.y1?1:0).attr("stroke-opacity",a=>0<a.view.y1?1:0),baobab.arcLabels.filter(a=>labelVisible(a)).attr("fill-opacity",1).attr("font-size",a=>labelFontSizeArc(a)).attr("transform",a=>labelTransform(a)),baobab.arcLabels.filter(a=>!labelVisible(a)).attr("fill-opacity",0)}for(var match,regex=/[?&]([^=#]+)=([^&#]*)/g,url=window.location.href,params={};match=regex.exec(url);)params[match[1]]=match[2];if(params.path){for(var path=params.path.split("/"),select=root,i=1;i<path.length;i++){const a=select.children.find(a=>a.data.name==path[i]);if(a&&a.children)select=a;else break}clicked(select)}