String.prototype.format||(String.prototype.format=function(){var a=Array.prototype.slice.call(arguments);return this.replace(/{(\d+)}/g,function(b,c){return"undefined"==typeof a[c]?b:a[c]})});function parseUrlParamAnyBool(a,b=!0){for(var c,d=/[?&]([^=#]+)=([^&#]*)/g,e=window.location.href,f={};c=d.exec(e);)f[c[1]]=c[2];if(f[a])switch(f[a].toLowerCase()){case"false":case"no":case"off":case"0":case"":return!1;case"true":case"yes":case"on":case"1":return!0;default:}return b}const viewBox={left:-50,top:-50,width:100,height:100};viewBox.radius=Math.min(viewBox.width,viewBox.height)/2,viewBox.right=viewBox.left+viewBox.width,viewBox.bottom=viewBox.top+viewBox.height,document.getElementById("baobab").setAttribute("viewBox","{0} {1} {2} {3}".format(viewBox.left,viewBox.top,viewBox.width,viewBox.height));const baobab={strokeWidth:viewBox.radius/750,globalFontSizeMax:viewBox.radius/10,globalFontSizeMin:viewBox.radius/50,showCommitAge:parseUrlParamAnyBool("showCommitAge")};function concatPath(a){for(var b=a.data.n,c=a.parent;c;c=c.parent)b=c.data.n+"/"+b;return b}function leastRecentString(a){return 0===a?"less than 1 year ago":1===a?"more than 1 year ago":2===a||3===a||4===a||5===a||6===a?"more than {0} years ago".format(a):"7 or more years ago".format(a)}function totalLinesString(a){return 0==a.t?" (created and deleted within period of interest)":", {0} overall".format(kiloMega(a.t))}function tooltipFormat(a){return[concatPath(a),"Authored {0} line changes{1}".format(kiloMega(a.data.m),totalLinesString(a.data)),"{0} commits, least recent {1}".format(a.data.c,leastRecentString(a.data.a))].join("\n")}const rad2deg=a=>90*a/Math.PI,dec2hex=a=>{const b=Math.round(a).toString(16);return 1==b.length?"0"+b:b},kiloMega=a=>1e6<a?Math.round(a/1e5)/10+"M":1e3<a?Math.round(a/100)/10+"K":a+"",hotColdColorsRGB=[{R:116,G:173,B:209},{R:171,G:217,B:233},{R:254,G:224,B:144},{R:253,G:174,B:97},{R:244,G:109,B:67}];function greyOutByAge(a,b){void 0,void 0;const c=(b-baobab_age_min)/(baobab_age_max+2-baobab_age_min);return 187*c+a*(1-c)}function colorHotColdDarkBright(a){if(0==a.data.t)return"#ddd";const b=a.data.m/a.data.t,c=Math.min(.999,Math.sqrt(b)),d=Math.floor(5*c),e=hotColdColorsRGB[d],f=baobab.showCommitAge?b=>dec2hex(greyOutByAge(b,a.data.a)):a=>dec2hex(a);return"#{0}{1}{2}".format(f(e.R),f(e.G),f(e.B))}function makeInitialViewCoords(a,b,c){var d=Math.max,e=Math.min;const f=2*Math.PI;return 0<a&&a<f||0<b&&b<f||0>=a&&f<=b?{x0:d(0,a),x1:e(f,b),y0:c,y1:c+1}:{x0:0,x1:0,y0:0,y1:0}}const hierarchy=a=>d3.hierarchy(a).sum(a=>a.children?0:a.w).sort((c,a)=>a.data.w-c.data.w),partition=a=>d3.partition().size([2*Math.PI,a.height])(a);baobab.root=partition(hierarchy(baobab_data)),baobab.root.each(a=>a.view=makeInitialViewCoords(a.x0,a.x1,a.depth));function makeScaleY(a){return d3.scaleLog().domain([1,a.height+1]).range([15,viewBox.radius])}var scale_y=makeScaleY(baobab.root);function labelTransform(a){if(1>=a.view.y0+a.view.y1||!a.padding)return``;var b=rad2deg(a.view.x0+a.view.x1),c=scale_y(a.view.y0)+a.padding+a.fontSize/2;return 90<=b&&270>=b?`rotate(${b+180}) translate(0, ${c})`:`rotate(${b}) translate(0, ${-c})`}const arc=d3.arc().startAngle(a=>a.view.x0).endAngle(a=>a.view.x1).innerRadius(a=>scale_y(a.view.y0)).outerRadius(a=>scale_y(a.view.y1));baobab.canvas=d3.select("#baobab").style("stroke-width",baobab.strokeWidth),baobab.arcShapes=baobab.canvas.append("g").selectAll("path").data(baobab.root.descendants().slice(1)).join("path").attr("d",a=>arc(a)),baobab.arcShapes.filter(a=>0<a.view.y1).attr("fill",a=>colorHotColdDarkBright(a)),baobab.arcShapes.filter(a=>a.children).style("cursor","pointer").on("click",selectAsNewRoot),baobab.arcShapes.on("mouseover",function(){d3.select(this).style("fill-opacity",.75)}).on("mouseout",function(){d3.select(this).style("fill-opacity",1)}),baobab.arcToolTips=baobab.arcShapes.append("title").text(a=>tooltipFormat(a));function balanceProportions(a,b){for(var c=Math.PI,d=c/2,e=0;d>e+.01;){const c=(e+d)/2;0<Math.sin(c)-a-2*Math.cos(c)/b?d=c:e=c}return e}function fitTextToArc(a,b){var c=Math.atan,d=Math.min;const e=c=>{var d=Math.pow;const e=a.innerRadius+c,f=Math.sqrt(d(c*b/2,2)+d(e,2));return a.outerRadius-f},f=Math.max(baobab.globalFontSizeMin,d(a.height/2,.9*a.innerLength/b,baobab.globalFontSizeMax)),g=e(f),h=c(f*b/(2*a.innerRadius+g));if(0<g&&h<a.centralAngle/2)return[f,g/2];const i=.1*a.height,j=(a.innerRadius+i)/(a.outerRadius-i),k=balanceProportions(j,b),l=a.outerRadius*(Math.sin(k)-j);if(l>baobab.globalFontSizeMin&&k<a.centralAngle/2){const a=e(l),b=d(l,baobab.globalFontSizeMax);if(0<a)return[b,a/2]}if(f>baobab.globalFontSizeMin){const d=e(baobab.globalFontSizeMin),f=c(baobab.globalFontSizeMin*b/(2*a.innerRadius+d));if(0<d&&f<a.centralAngle/2)return[baobab.globalFontSizeMin,d/2]}return[.001,0]}function makeArcSpec(a){const b={};return b.innerRadius=scale_y(a.y0),b.outerRadius=scale_y(a.y1),b.centralAngle=a.x1-a.x0,b.innerLength=b.centralAngle*b.innerRadius,b.height=b.outerRadius-b.innerRadius,b}function labelFontSizeArc(a){return[a.fontSize,a.padding]=fitTextToArc(makeArcSpec(a.view),a.textRatio),.001>=a.fontSize&&void 0,a.fontSize+"px"}function labelVisible(a){if(0==a.view.y1)return!1;const b=makeArcSpec(a.view);return!(baobab.globalFontSizeMin>b.height/2||baobab.globalFontSizeMin*a.textRatio>b.outerRadius)}function labelFontSizeRoot(a,b){var c=Math.min;const d=(b.fontSize||14)/a.getComputedTextLength(),e=.9*(2*scale_y(1)*d);return b.fontSize=c(e,baobab.globalFontSizeMax),b.fontSize+"px"}baobab.arcLabels=baobab.canvas.append("g").attr("pointer-events","none").selectAll("text").data(baobab.root.descendants().slice(1)).join("text").text(a=>a.data.n),baobab.arcLabels.each(function(a){a.textRatio=this.getComputedTextLength()/14,a.visible=labelVisible(a)}),baobab.arcLabels.filter(a=>a.visible).style("font-size",a=>labelFontSizeArc(a)).attr("transform",a=>labelTransform(a)).style("fill-opacity",1).on("click",selectAsNewRoot),baobab.rootShape=baobab.canvas.append("circle").datum(baobab.root).attr("r",scale_y(1)).style("fill","#f8f8f8").attr("pointer-events","all").on("click",a=>selectAsNewRoot(a.parent)),baobab.rootLabel=baobab.canvas.append("text").datum(baobab.root).text(a=>concatPath(a)).attr("dy","-1.8px").style("fill-opacity",1).style("font-family","sans-serif").style("font-size",function(a){return labelFontSizeRoot(this,a)}),baobab.rootLabelCommitRange=baobab.canvas.append("text").datum(baobab.root).attr("dy","1.6px").style("font-size","1.6px").style("font-family","sans-serif").style("fill-opacity",1).text("{0}..{1}".format(baobab_hash_since.substr(0,12),baobab_hash_head.substr(0,12))),baobab.rootLabelAuthor=baobab.canvas.append("text").datum(baobab.root).attr("pointer-events","none").attr("dy","5.0px").style("font-size","1.6px").style("font-family","sans-serif").style("fill-opacity",1).style("fill","#aaa").text(()=>baobab_author),baobab.rootLabelLinesAuthored=baobab.canvas.append("text").datum(baobab.root).attr("pointer-events","none").attr("dy","7.5px").style("font-size","1.6px").style("font-family","sans-serif").style("fill-opacity",1).style("fill","#aaa").text(a=>"{0} insertions / deletions".format(kiloMega(a.data.m))),baobab.rootLabelLinesOverall=baobab.canvas.append("text").datum(baobab.root).attr("pointer-events","none").attr("dy","10.0px").style("font-size","1.6px").style("font-family","sans-serif").style("fill-opacity",1).style("fill","#aaa").text(a=>"{0} overall".format(kiloMega(a.data.t)));function selectAsNewRoot(a){var b=Math.PI;const c=a||baobab.root;scale_y=makeScaleY(c),baobab.rootShape.datum(c).style("cursor",c.parent?"pointer":"default"),baobab.rootLabel.text(concatPath(c)).style("font-size",function(a){return labelFontSizeRoot(this,a)}),baobab.rootLabelLinesOverall.datum(c).text(a=>"{0} overall".format(kiloMega(a.data.t))),baobab.rootLabelLinesAuthored.datum(c).text(a=>"{0} insertions / deletions".format(kiloMega(a.data.m)));const d=1/(c.x1-c.x0),e=(a,e,f)=>{const g=f-c.depth;if(0<g){const f=(a-c.x0)*d,h=(e-c.x0)*d;if(0<f&&1>f||0<h&&1>h||0>=f&&1<=h)return{x0:2*Math.max(0,f)*b,x1:2*Math.min(1,h)*b,y0:g,y1:g+1}}return{x0:0,x1:0,y0:0,y1:0}};baobab.arcShapes.each(a=>a.view=e(a.x0,a.x1,a.depth)).attr("d",a=>arc(a)),baobab.arcLabels.each(a=>a.visible=labelVisible(a)).style("fill-opacity",a=>+a.visible),baobab.arcLabels.filter(a=>a.visible).style("font-size",a=>labelFontSizeArc(a)).attr("transform",a=>labelTransform(a))}